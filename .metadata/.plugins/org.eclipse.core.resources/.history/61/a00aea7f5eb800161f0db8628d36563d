package app.rest;

import javax.ws.rs.Consumes;
import javax.ws.rs.FormParam;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import javax.ws.rs.core.MediaType;

import app.entities.Bus;
import app.entities.Passenger;
import app.entities.Route;
import app.entities.Trip;
import app.repositories.BusRepository;
import app.repositories.PassengerRepository;
import app.repositories.RouteRepository;
import app.repositories.TripRepository;

@Component
@Path("/admin")
public class AdminServer {
	
	@Autowired
	private PassengerRepository passengerRepo;
	@Autowired
	private BusRepository busRepo;
	@Autowired
	private RouteRepository routeRepo;
	@Autowired
	private TripRepository tripRepo;
	
	@GET
	@Path("/viewPassengerInfo")
	@Consumes(MediaType.TEXT_PLAIN)
	@Produces(MediaType.APPLICATION_JSON)
	public Passenger viewPassengerInfo(@QueryParam("mobileNumber") String mobileNumber){
		Passenger p = passengerRepo.findByMobileNumber(mobileNumber);
		return p;
	}
	
	@POST
	@Path("/deletePassenger")
	public void deletePassenger(String mobileNumber){
		passengerRepo.deletePassenger(mobileNumber);
	}
	
	@POST
	@Path("/createTrip")
	public void createTrip(@FormParam("tripName") String tripName, @FormParam("ETD") String ETD, @FormParam("ETA") String ETA,
			@FormParam("routeName") String routeName, @FormParam("plateName") String plateNumber){
		Bus b = busRepo.findByPlateNumber(plateNumber);
		Route r = routeRepo.findByRouteName(routeName);
		Trip t = new Trip();
//		tripName, ETD, ETA, r, b
		t.setTripName(tripName);
		t.setETA(ETD);
		t.setETA(ETA);
		t.setAssignedRoute(r);
		t.setAssignedBus(b);
		tripRepo.save(t);
	}
	
	@POST
	@Path("/updateTrip")
	public void updateTrip(String tripName, String newETD, String newETA){
//		Trip t = tripRepo.findByTripName(tripName);
//		Trip temp = t;
//		tripRepo.delete(temp);
//		t.setETA(newETA);
//		t.setETD(newETD);
//		tripRepo.save(t);
		
		tripRepo.setETA(newETA, tripName);
		tripRepo.setETD(newETD, tripName);
	}
	
	@POST
	@Path("/deleteTrip")
	public void deleteTrip(String tripName){
		Trip t = tripRepo.findByTripName(tripName);
		tripRepo.delete(t);
	}
	
	@POST
	@Path("/sendUpdates")
	public void sendUpdates(String message, String[] mobileNumbers){
		//OMG Cel paano to
	}
}
